generator client {
  provider = "prisma-client-js"
  output   = "./src/shared/prisma"
}

datasource db {
  provider = "postgresql"
}

// Enums based on PRD
enum Role {
  ADMIN // 개발 관리자
  PASTOR // 목사님
  LEADER // 셀리더/소그룹 리더
  MEMBER // 성도
  NEWCOMER // 새신자
}

enum MemberType {
  // 새신자 타입
  A // 교회가 처음인 사람
  B // 교회를 오랜만에 다시 나온 사람
  C // 교회가 익숙한 사람

  // 기존 성도 타입
  D // 예배만 드리는 성도
  E // 스스로 모임에 참여
  F // 전반적으로 적극적
  G // 관심이 필요한 성도
}

enum VisaType {
  STUDENT
  WORKING_HOLIDAY
  TRAVELLING
  SPONSERSHIP
  CITIZENSHIP
  PRDGRADUATE
  ETC
}

enum NewcomerEducationStatus {
  READY
  IN_PROGRESS
  COMPLETED
}

model User {
  id     String  @id @default(uuid())
  email  String  @unique
  // Password should be handled by Supabase Auth usually, but if custom auth:
  // password String 
  // For now, assuming we might link Supabase Auth User ID here or just store email.
  // Ideally, 'id' here matches Supabase User ID.
  person Person?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Person {
  id        String    @id @default(uuid())
  firstName String
  lastName  String
  phone     String
  bod       DateTime?
  gender    Boolean?
  address   String?

  // Church specific info
  role Role        @default(MEMBER)
  type MemberType?

  // Visa / Status (Text for now or Enum if strictly defined)
  visaType   VisaType?
  occupation String?

  // Faith info
  isBaptized      Boolean @default(false)
  previousChurch  String?
  previousService String?

  // Newcomer specific
  visitedAt   DateTime?
  inviterName String?
  // inviterId   String? // Link to Person if inviter is in system?

  // Relations
  user   User?   @relation(fields: [userId], references: [id])
  userId String? @unique

  group   Group? @relation(fields: [groupId], references: [id])
  groupId String

  groupsLed Group[] @relation("GroupLeader")

  histories History[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model GroupType {
  id     String  @id @default(uuid())
  name   String
  groups Group[]
}

model Group {
  id   String    @id @default(uuid())
  name String
  type GroupType @relation(fields: [groupTypeId], references: [id])

  // Leader
  leader   Person? @relation("GroupLeader", fields: [leaderId], references: [id])
  leaderId String?

  // Hierarchy
  parent   Group?  @relation("GroupHierarchy", fields: [parentId], references: [id])
  parentId String?
  children Group[] @relation("GroupHierarchy")

  members Person[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  groupTypeId String
}

model History {
  id       String @id @default(uuid())
  content  String
  category String // e.g., "ASSIGNMENT", "LEVEL_CHANGE", "MEMO"

  person   Person @relation(fields: [personId], references: [id])
  personId String

  createdBy String? // Name or ID of the admin/leader

  createdAt DateTime @default(now())
}
